{% extends 'base.html' %}

{% block content %}
  <section>
    <div class="actions">
      {% if type == 'api_keys' %}
      <a class="btn" href="/admin/api-keys/create">Create API Key</a>
      {% endif %}
    </div>

    <table class="table">
      <thead>
        <tr>
          {% if type == 'api_keys' %}
            <th>ID</th>
            <th>Name</th>
                <th>Active</th>
                <th>Daily limit</th>
                <th>Allowed recipients</th>
            <th>Created</th>
          {% elif type == 'daily_usage' %}
            <th>ID</th>
            <th>API Key ID</th>
            <th>Day</th>
            <th>Count</th>
          {% elif type == 'send_logs' %}
            <th>ID</th>
            <th>API Key ID</th>
            <th>Recipient</th>
            <th>Sent at</th>
          {% endif %}
        </tr>
      </thead>
      <tbody>
        {% for it in items %}
          <tr>
            {% if type == 'api_keys' %}
              <td>{{ it.id }}</td>
              <td>{{ it.name }}</td>
              <td>{{ it.is_active }}</td>
              <td>{{ it.daily_limit }}</td>
              <td>{% if it.allowed_recipients %}{{ it.allowed_recipients | join(", ") }}{% else %}&mdash;{% endif %}</td>
              <td>{{ it.created_at }}</td>
              <td>
                {% if it.is_active %}
                <form method="post" action="/admin/api-keys/{{ it.id }}/deactivate" style="display:inline">
                  <button class="btn small" type="submit">Deactivate</button>
                </form>
                {% else %}
                <form method="post" action="/admin/api-keys/{{ it.id }}/activate" style="display:inline">
                  <button class="btn small" type="submit">Activate</button>
                </form>
                {% endif %}
              </td>
            {% elif type == 'daily_usage' %}
              <td>{{ it.id }}</td>
              <td>{{ it.api_key_id }}</td>
              <td>{{ it.day }}</td>
              <td>{{ it.count }}</td>
            {% elif type == 'send_logs' %}
              <td>{{ it.id }}</td>
              <td>{{ it.api_key_id }}</td>
              <td>{{ it.recipient }}</td>
              <td>{{ it.sent_at }}</td>
            {% endif %}
          </tr>
        {% else %}
          <tr><td colspan="6">No records found</td></tr>
        {% endfor %}
      </tbody>
    </table>
    {% if total is defined %}
      <div class="pagination">
        <span>Showing page {{ page }} ({{ per_page }} per page) â€” total {{ total }}</span>
        <div class="pager">
          {% if page > 1 %}
            <a class="btn" href="?page={{ page-1 }}&per_page={{ per_page }}">Prev</a>
          {% endif %}
          {% if (page * per_page) < total %}
            <a class="btn" href="?page={{ page+1 }}&per_page={{ per_page }}">Next</a>
          {% endif %}
        </div>
      </div>
    {% endif %}
  </section>
{% endblock %}
