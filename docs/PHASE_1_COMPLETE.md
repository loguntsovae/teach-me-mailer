# üéâ –§–∞–∑–∞ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ - –ó–ê–í–ï–†–®–ï–ù–ê

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### 1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
–°–æ–∑–¥–∞–Ω–∞ –ø–æ–ª–Ω–∞—è –∏–µ—Ä–∞—Ä—Ö–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π:
```
tests/
‚îú‚îÄ‚îÄ __init__.py
‚îú‚îÄ‚îÄ conftest.py                    # ‚úÖ –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã
‚îú‚îÄ‚îÄ pytest.ini                     # ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è pytest
‚îú‚îÄ‚îÄ README.md                      # ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤
‚îú‚îÄ‚îÄ test_smoke.py                  # ‚úÖ Smoke —Ç–µ—Å—Ç—ã (–≤—Å–µ –ø—Ä–æ—Ö–æ–¥—è—Ç!)
‚îÇ
‚îú‚îÄ‚îÄ unit/                          # ‚úÖ –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îú‚îÄ‚îÄ schemas/
‚îÇ   ‚îî‚îÄ‚îÄ core/
‚îÇ
‚îú‚îÄ‚îÄ integration/                   # ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ
‚îî‚îÄ‚îÄ e2e/                          # ‚úÖ End-to-end —Ç–µ—Å—Ç—ã
```

### 2. –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏:
- ‚úÖ pytest >= 7.4.0
- ‚úÖ pytest-asyncio >= 0.21.0
- ‚úÖ pytest-cov >= 4.1.0
- ‚úÖ pytest-mock >= 3.12.0
- ‚úÖ pytest-xdist >= 3.5.0 (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã)
- ‚úÖ pytest-timeout >= 2.4.0 (—Ç–∞–π–º–∞—É—Ç—ã)
- ‚úÖ pytest-env >= 1.1.0 (env –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ)
- ‚úÖ httpx >= 0.25.0 (HTTP –∫–ª–∏–µ–Ω—Ç)
- ‚úÖ faker >= 20.1.0 (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö)
- ‚úÖ freezegun >= 1.4.0 (–º–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏)
- ‚úÖ coverage >= 7.3.0 (–ø–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞)

### 3. –¢–µ—Å—Ç–æ–≤–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ PostgreSQL –Ω–∞ localhost (test_teach_me_mailer)
- ‚úÖ –°—Ö–µ–º–∞ `mailer` —Å–æ–∑–¥–∞–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏–∏ Alembic –ø—Ä–∏–º–µ–Ω–µ–Ω—ã
- ‚úÖ –°–∫—Ä–∏–ø—Ç `scripts/setup_test_db.py` –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### 4. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

#### conftest.py - –§–∏–∫—Å—Ç—É—Ä—ã
- ‚úÖ `test_settings` - —Ç–µ—Å—Ç–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- ‚úÖ `test_engine` - async SQLAlchemy engine
- ‚úÖ `db_session` - —Å–µ—Å—Å–∏—è –ë–î —Å –æ—Ç–∫–∞—Ç–æ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- ‚úÖ `test_client` - HTTP –∫–ª–∏–µ–Ω—Ç –¥–ª—è API —Ç–µ—Å—Ç–æ–≤
- ‚úÖ `test_api_key` - —Ç–µ—Å—Ç–æ–≤—ã–π API –∫–ª—é—á (–∞–∫—Ç–∏–≤–Ω—ã–π)
- ‚úÖ `test_api_key_inactive` - –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–π API –∫–ª—é—á
- ‚úÖ `test_api_key_with_recipient_limit` - –∫–ª—é—á —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏
- ‚úÖ `mock_smtp` - –º–æ–∫ SMTP —Å–µ—Ä–≤–µ—Ä–∞
- ‚úÖ `mock_mailer_service` - –º–æ–∫ —Å–µ—Ä–≤–∏—Å–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏
- ‚úÖ `mock_rate_limit_service` - –º–æ–∫ rate limiting
- ‚úÖ `mock_sentry` - –º–æ–∫ Sentry SDK

#### pytest.ini
- ‚úÖ Async mode: auto
- ‚úÖ Coverage –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- ‚úÖ –ö–∞—Å—Ç–æ–º–Ω—ã–µ –º–∞—Ä–∫–µ—Ä—ã (unit, integration, e2e, slow, smtp, database)
- ‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ: 85%
- ‚úÖ –§–∏–ª—å—Ç—Ä—ã –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π

#### .env.test
- ‚úÖ –¢–µ—Å—Ç–æ–≤–∞—è DATABASE_URL
- ‚úÖ –ú–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ SMTP –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- ‚úÖ Rate limiting –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –∫–ª—é—á–∏

### 5. Makefile –∫–æ–º–∞–Ω–¥—ã
–î–æ–±–∞–≤–ª–µ–Ω—ã —É–¥–æ–±–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–µ—Å—Ç–∞–º–∏:
```bash
make setup-test-db       # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–π –ë–î
make test               # –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
make test-unit          # –¢–æ–ª—å–∫–æ —é–Ω–∏—Ç-—Ç–µ—Å—Ç—ã
make test-integration   # –¢–æ–ª—å–∫–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
make test-e2e           # –¢–æ–ª—å–∫–æ E2E —Ç–µ—Å—Ç—ã
make test-coverage      # –° –æ—Ç—á–µ—Ç–æ–º –ø–æ–∫—Ä—ã—Ç–∏—è
make test-fast          # –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫
make test-smoke         # Smoke —Ç–µ—Å—Ç—ã
make test-clean         # –û—á–∏—Å—Ç–∫–∞ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤
```

### 6. Smoke —Ç–µ—Å—Ç—ã
–í—Å–µ 8 –±–∞–∑–æ–≤—ã—Ö smoke —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ ‚úÖ:
```
‚úÖ test_sanity_check              # –ë–∞–∑–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
‚úÖ test_settings_fixture           # –§–∏–∫—Å—Ç—É—Ä–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫
‚úÖ test_db_session_fixture         # –§–∏–∫—Å—Ç—É—Ä–∞ –ë–î
‚úÖ test_mock_smtp_fixture          # –ú–æ–∫ SMTP
‚úÖ test_test_client_fixture        # HTTP –∫–ª–∏–µ–Ω—Ç
‚úÖ test_test_api_key_fixture       # API –∫–ª—é—á
‚úÖ test_pytest_markers             # –ú–∞—Ä–∫–µ—Ä—ã
‚úÖ test_async_test_support         # Async —Ç–µ—Å—Ç—ã
```

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–ê–í–ï–†–®–ï–ù–ê

**–í—Ä–µ–º—è:** ~2 —á–∞—Å–∞

**Smoke —Ç–µ—Å—Ç—ã:** 8/8 –ø—Ä–æ—Ö–æ–¥—è—Ç (100%)

**–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≥–æ—Ç–æ–≤–∞ –∫:**
- –ù–∞–ø–∏—Å–∞–Ω–∏—é —é–Ω–∏—Ç-—Ç–µ—Å—Ç–æ–≤
- –ù–∞–ø–∏—Å–∞–Ω–∏—é –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
- –ù–∞–ø–∏—Å–∞–Ω–∏—é E2E —Ç–µ—Å—Ç–æ–≤
- –ò–∑–º–µ—Ä–µ–Ω–∏—é –ø–æ–∫—Ä—ã—Ç–∏—è –∫–æ–¥–∞
- CI/CD –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –§–∞–∑–∞ 2: –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã (3-4 –¥–Ω—è)
–ù–∞—á–∞—Ç—å —Å:
1. `tests/unit/services/test_auth.py` - —Ç–µ—Å—Ç—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
2. `tests/unit/services/test_mailer.py` - —Ç–µ—Å—Ç—ã –æ—Ç–ø—Ä–∞–≤–∫–∏ email
3. `tests/unit/services/test_rate_limit.py` - —Ç–µ—Å—Ç—ã –ª–∏–º–∏—Ç–æ–≤

## üìù –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ (–æ–¥–∏–Ω —Ä–∞–∑)
make setup-test-db

# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
pytest

# Smoke —Ç–µ—Å—Ç
pytest tests/test_smoke.py -v

# –° –ø–æ–∫—Ä—ã—Ç–∏–µ–º
pytest --cov=app --cov-report=html
```

## üéì –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- üìñ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤: `tests/README.md`
- üìã –ü–ª–∞–Ω —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: `docs/TESTING_PLAN.md`
- üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è: `pytest.ini`
- üóÉÔ∏è –°–∫—Ä–∏–ø—Ç –ë–î: `scripts/setup_test_db.py`

---

**–ì–æ—Ç–æ–≤–æ –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –∫ –§–∞–∑–µ 2!** üöÄ
